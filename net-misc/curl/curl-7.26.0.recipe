SUMMARY="A commandline-tool and library for downloading data from URLs"
HOMEPAGE="http://curl.haxx.se"
COPYRIGHT="1996-2012, Daniel Stenberg, <daniel@haxx.se>. All rights reserved."
LICENSE="Curl"
SRC_URI="http://curl.haxx.se/download/curl-7.26.0.tar.bz2"
CHECKSUM_MD5="bfa80f01b3d300359cfb4d409b6136a3"
REVISION="4"
ARCHITECTURES="x86_gcc2 ?x86"

PATCHES="curl-7.26.0.patch"

PROVIDES="
	curl = $portVersion
	cmd:curl = $portVersion compat >= 7.16
	lib:libcurl = 4.2.0 compat >= 4
	"
REQUIRES="
	haiku >= $haikuVersion
	ca_root_certificates
	lib:libssl
	lib:libz
	"
BUILD_REQUIRES="
	devel:libssl
	devel:libz
	"
BUILD_PREREQUIRES="
	haiku_devel >= $haikuVersion
	cmd:autoconf
	cmd:gcc
	cmd:ld
	cmd:libtoolize
	cmd:make
	"

SOURCE_DIR="$portVersionedName"

BUILD()
{
	certsInstallDir="$portPackageLinksDir/ca_root_certificates"
	certsDir="$certsInstallDir/$relativeDataRootDir/ssl"

	libtoolize --force --copy --install
	autoconf
	runConfigure ./configure \
		--enable-ipv6 \
		--with-ca-bundle="$certsDir/CARootCertificates.pem"
	make $jobArgs
}

INSTALL()
{
	make install

	# prepare develop/lib
	prepareInstalledDevelLibs libcurl
	fixPkgconfig

	# fix curl-config
	fixDevelopLibDirReferences $binDir/curl-config
	sed -i -e "s,--libexecdir=$developLibDir,--libexecdir=$libExecDir,g" \
		-e "s,--libdir=$developLibDir,--libdir=$libDir,g" $binDir/curl-config

	# install html documentation for curl
	mkdir -p "$docDir"
	install -c -m 644 "docs/curl.html" "$docDir"

	# install html development documentation for libcurl
	mkdir -p "$developDocDir"
	for h in docs/libcurl/*.html; do 
		install -c -m 644 "$h" "$developDocDir"
	done

	# devel package
	packageEntries devel \
		$binDir/curl-config \
		$developDir \
		$manDir/man3
}

TEST()
{
	make check
}

DESCRIPTION="
	Curl is a command line tool for transferring data with URL syntax, 
	supporting DICT, FILE, FTP, FTPS, Gopher, HTTP, HTTPS, IMAP, IMAPS, LDAP, 
	LDAPS, POP3, POP3S, RTMP, RTSP, SCP, SFTP, SMTP, SMTPS, Telnet and TFTP. 
	curl supports SSL certificates, HTTP POST, HTTP PUT, FTP uploading, 
	HTTP form based upload, proxies, cookies, user+password authentication 
	(Basic, Digest, NTLM, Negotiate, kerberos...), file transfer resume, 
	proxy tunneling and a busload of other useful tricks.
	"

# ----- devel package -------------------------------------------------------

PROVIDES_devel="
	curl_devel = $portVersion
	cmd:curl_config = $portVersion compat >= 7.16
	devel:libcurl = 4.2.0 compat >= 4
	"
REQUIRES_devel="
	curl == $portVersion base
	"
