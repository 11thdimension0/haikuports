SUMMARY="Librares that help developers build software on top of Qt."
DESCRIPTION="KDE (the K Desktop Environment) is a powerful, open-source \
graphical desktop environment. It combines ease of use, contemporary \
functionality, and outstanding graphical design."
HOMEPAGE="http://www.kde.org"
SRC_URI="http://download.kde.org/stable/4.13.2/src/kdelibs-4.13.2.tar.xz"
CHECKSUM_SHA256="559809c602b80ff1091a4fb67e8c98b0ebb91c3cd437d1583068ddde19efda0e"
SOURCE_DIR="kdelibs-4.13.2"
LICENSE="GNU LGPL v2.1"
COPYRIGHT="2014 KDE e.V."
REVISION="1"
ARCHITECTURES="x86 ?x86_64"
if [ $effectiveTargetArchitecture != x86_gcc2 ]; then
    # x86_gcc2 is fine as primary target architecture as long as we're building
    # for a different secondary architecture.
    ARCHITECTURES="$ARCHITECTURES x86_gcc2"
else
    ARCHITECTURES="$ARCHITECTURES !x86_gcc2"
fi
SECONDARY_ARCHITECTURES="x86"
PATCHES="kdelibs4-4.13.2.patch"

PROVIDES="
	kdelibs4$secondaryArchSuffix = $portVersion compat >= 4.8
	"

REQUIRES="
	haiku$secondaryArchSuffix >= $haikuVersion
	libqt4$secondaryArchSuffix >= 4.8
	lib:libz$secondaryArchSuffix
	lib:libbz2$secondaryArchSuffix
	lib:liblzma$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	lib:libcrypto$secondaryArchSuffix
	lib:libqca$secondaryArchSuffix
	lib:libintl$secondaryArchSuffix
	lib:libpcre$secondaryArchSuffix
	lib:libxml2$secondaryArchSuffix
	lib:libxslt$secondaryArchSuffix
	lib:libgif$secondaryArchSuffix
	lib:libpng$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libjasper$secondaryArchSuffix
	lib:libattica$secondaryArchSuffix
	lib:libdbusmenu_qt$secondaryArchSuffix
	shared_mime_info$secondaryArchSuffix
	strigi$secondaryArchSuffix
	"

BUILD_REQUIRES="
	libqt4${secondaryArchSuffix}_devel >= 4.8
	devel:libz$secondaryArchSuffix
	devel:libbz2$secondaryArchSuffix
	devel:liblzma$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
	devel:libcrypto$secondaryArchSuffix
	devel:libqca$secondaryArchSuffix
	devel:libintl$secondaryArchSuffix
	devel:libpcre$secondaryArchSuffix
	devel:libxml2$secondaryArchSuffix
	devel:libxslt$secondaryArchSuffix
	devel:libgif$secondaryArchSuffix
	devel:libpng$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libjasper$secondaryArchSuffix
	devel:libattica$secondaryArchSuffix
	devel:libdbusmenu_qt$secondaryArchSuffix
	docbook_xml_dtd
	docbook_xsl_stylesheets
	shared_mime_info$secondaryArchSuffix
	strigi${secondaryArchSuffix}_devel
	"

BUILD_PREREQUIRES="
	haiku${secondaryArchSuffix}_devel >= $haikuVersion
	cmd:cmake
	cmd:pkg_config$secondaryArchSuffix
	cmd:automoc4
	cmd:perl
	cmd:flex
	cmd:bison$secondaryArchSuffix
	cmd:xmllint
	cmd:ninja
	cmd:g++$secondaryArchSuffix
	"

PROVIDES_devel="
	kdelibs4${secondaryArchSuffix}_devel = $portVersion compat >= 4.13
	"

REQUIRES_devel="
	haiku$secondaryArchSuffix >= $haikuVersion
	kdelibs4${secondaryArchSuffix} == $portVersion base
	libqt4${secondaryArchSuffix}_devel == $portVersion
	"

BUILD()
{
	mkdir -p build
	cd build
	cmake -Wno-dev -DCMAKE_INSTALL_PREFIX=$prefix \
		-DDOCBOOKXML_CURRENTDTD_DIR=/system/data/xml/docbook/xml-dtd-4.5 \
		-DDOCBOOKXSL_DIR=/system/data/xml/docbook/xsl-stylesheets-1.78.1 \
		-DCMAKE_BUILD_TYPE=Release -DKDE4_BUILD_TESTS=Off -GNinja ..
	ninja $jobArgs
}

INSTALL()
{
	cd build
	ninja install
}
