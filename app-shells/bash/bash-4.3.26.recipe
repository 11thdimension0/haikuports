SUMMARY="The GNU Bourne Again Shell"
DESCRIPTION="
Bash is an sh-compatible command language interpreter that \
executes commands read from the standard input or from a file. Bash also \
incorporates useful features from the Korn and C shells (ksh and csh).
"
HOMEPAGE="http://www.gnu.org/software/bash/"
SRC_URI="https://ftp.gnu.org/gnu/bash/bash-4.3.tar.gz"
CHECKSUM_SHA256="afc687a28e0e24dc21b988fa159ff9dbcf6b7caa92ade8645cc6d5605cd024d4"
PATCHES="bash-kill_by_name.patch"
SOURCE_DIR="bash-4.3"
REVISION="1"
LICENSE="GNU GPL v3"
COPYRIGHT="2013 Free Software Foundation, Inc."
ARCHITECTURES="x86_gcc2 x86 x86_64"

PROVIDES="
	bash = $portVersion
	cmd:bash = $portVersion
	cmd:bashbug = $portVersion
	"

REQUIRES="
	haiku >= $haikuVersion
	lib:libreadline
	lib:libncursesw
	"

BUILD_REQUIRES="
	haiku_devel
	devel:libreadline
	devel:libncursesw
	cmd:gcc
	cmd:bison
	cmd:make
	cmd:awk
	cmd:wget
	cmd:patch
	"

PATCH()
{
	# Yes, this is nasty. But the GNU guys don't seem to want to ship
	# patch releases, instead they want to ship patches. Hence this.
	mkdir -p patches
	for i in {001..026}; do
		wget "https://ftp.gnu.org/gnu/bash/bash-4.3-patches/bash43-$i" \
			-O patches/bash43-$i.patch
		patch -p0 <patches/bash43-$i.patch
	done
	rm -rf patches
}

BUILD()
{
	runConfigure ./configure --without-bash-malloc --with-installed-readline
	make $jobArgs
}

INSTALL()
{
	make install
}
