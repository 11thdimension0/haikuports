From 4d386b384810ea29ed942212085181dc7d188026 Mon Sep 17 00:00:00 2001
From: Kacper Kasper <kacperkasper@gmail.com>
Date: Sat, 5 Jul 2014 02:12:23 +0200
Subject: Haiku support


diff --git a/nss/coreconf/BeOS.mk b/nss/coreconf/BeOS.mk
index 750696d..b53cfea 100644
--- a/nss/coreconf/BeOS.mk
+++ b/nss/coreconf/BeOS.mk
@@ -7,7 +7,7 @@ include $(CORE_DEPTH)/coreconf/UNIX.mk
 
 XP_DEFINE := $(XP_DEFINE:-DXP_UNIX=-DXP_BEOS)
 
-USE_PTHREADS = 
+USE_PTHREADS = 1
 
 ifeq ($(USE_PTHREADS),1)
 	IMPL_STRATEGY = _PTH
@@ -27,7 +27,7 @@ else
 	CPU_ARCH	= x86
 endif
 
-MKSHLIB		= $(CC) -nostart -Wl,-soname -Wl,$(@:$(OBJDIR)/%.so=%.so)
+MKSHLIB		= $(CC) -shared -Wl,-soname -Wl,$(@:$(OBJDIR)/%.so=%.so)
 ifdef BUILD_OPT
 	OPTIMIZER	= -O2
 endif
diff --git a/nss/coreconf/arch.mk b/nss/coreconf/arch.mk
index 782e6c0..669e52a 100644
--- a/nss/coreconf/arch.mk
+++ b/nss/coreconf/arch.mk
@@ -41,6 +41,14 @@ else
 endif
 
 #
+# Force the Haiku machines to use BeOS.
+#
+
+ifeq ($(OS_ARCH),Haiku)
+	OS_ARCH = BeOS
+endif
+
+#
 # Force the IRIX64 machines to use IRIX.
 #
 
diff --git a/nss/lib/dbm/include/mcom_db.h b/nss/lib/dbm/include/mcom_db.h
index f204484..5cb10ee 100644
--- a/nss/lib/dbm/include/mcom_db.h
+++ b/nss/lib/dbm/include/mcom_db.h
@@ -66,7 +66,7 @@ typedef PRUint32 uint32;
 #include <sys/byteorder.h>
 #endif
 
-#if defined(__linux) || defined(__BEOS__)
+#if defined(__linux) || defined(BEOS)
 #include <endian.h>
 #ifndef BYTE_ORDER
 #define BYTE_ORDER    __BYTE_ORDER
-- 
1.8.3.4

