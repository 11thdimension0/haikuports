diff -urN apr-1.4.2/build/apr_hints.m4 apr-1.4.2-haiku/build/apr_hints.m4
--- apr-1.4.2/build/apr_hints.m4	2009-11-17 14:28:12.036700160 +0000
+++ apr-1.4.2-haiku/build/apr_hints.m4	2010-10-13 02:38:51.257687552 +0000
@@ -35,7 +35,7 @@
 dnl  Generally, we force the setting of CC, and add flags
 dnl  to CFLAGS, CPPFLAGS, LIBS and LDFLAGS. 
 dnl
-AC_DEFUN(APR_PRELOAD, [
+AC_DEFUN([APR_PRELOAD], [
 if test "x$apr_preload_done" != "xyes" ; then
 
   apr_preload_done="yes"
@@ -457,6 +457,12 @@
 	APR_SETIFNULL(have_proc_invoked, [1])
 	APR_SETIFNULL(apr_cv_use_lfs64, [yes])
 	;;
+    *-haiku*)
+        APR_ADDTO(LIBS, [-lnetwork])
+        APR_SETIFNULL(apr_lock_method, [USE_POSIXSEM_SERIALIZE])
+        APR_SETIFNULL(apr_posixsem_is_global, [yes])
+        APR_SETIFNULL(apr_process_lock_is_global, [yes])
+        ;;
   esac
 
 fi
@@ -467,7 +473,7 @@
 dnl
 dnl  Allows us to provide a default choice of compiler which
 dnl  the user can override.
-AC_DEFUN(APR_CC_HINTS, [
+AC_DEFUN([APR_CC_HINTS], [
 case "$host" in
   *-apple-aux3*)
       APR_SETIFNULL(CC, [gcc])
diff -urN apr-1.4.2/build/apr_network.m4 apr-1.4.2-haiku/build/apr_network.m4
--- apr-1.4.2/build/apr_network.m4	2008-06-16 21:15:24.035913728 +0000
+++ apr-1.4.2-haiku/build/apr_network.m4	2010-10-13 02:38:51.267911168 +0000
@@ -21,7 +21,7 @@
 dnl
 dnl check for type in_addr
 dnl
-AC_DEFUN(APR_TYPE_IN_ADDR,[
+AC_DEFUN([APR_TYPE_IN_ADDR],[
   AC_CACHE_CHECK(for type in_addr, ac_cv_type_in_addr,[
   AC_TRY_COMPILE([
 #ifdef HAVE_SYS_TYPES_H
diff -urN apr-1.4.2/build/apr_threads.m4 apr-1.4.2-haiku/build/apr_threads.m4
--- apr-1.4.2/build/apr_threads.m4	2006-08-03 10:46:47.037748736 +0000
+++ apr-1.4.2-haiku/build/apr_threads.m4	2010-10-13 02:38:51.269221888 +0000
@@ -26,7 +26,7 @@
 dnl pthreads is not available.
 dnl Turn off warnings if we're using gcc.
 dnl
-AC_DEFUN(APR_CHECK_PTHREADS_H, [
+AC_DEFUN([APR_CHECK_PTHREADS_H], [
   if test "$GCC" = "yes"; then
     SAVE_FL="$CPPFLAGS"
     CPPFLAGS="$CPPFLAGS -w"
@@ -41,7 +41,7 @@
 dnl
 dnl APR_CHECK_PTHREAD_GETSPECIFIC_TWO_ARGS
 dnl
-AC_DEFUN(APR_CHECK_PTHREAD_GETSPECIFIC_TWO_ARGS, [
+AC_DEFUN([APR_CHECK_PTHREAD_GETSPECIFIC_TWO_ARGS], [
 AC_CACHE_CHECK(whether pthread_getspecific takes two arguments, ac_cv_pthread_getspecific_two_args,[
 AC_TRY_COMPILE([
 #include <pthread.h>
@@ -65,7 +65,7 @@
 dnl
 dnl APR_CHECK_PTHREAD_ATTR_GETDETACHSTATE_ONE_ARG
 dnl
-AC_DEFUN(APR_CHECK_PTHREAD_ATTR_GETDETACHSTATE_ONE_ARG, [
+AC_DEFUN([APR_CHECK_PTHREAD_ATTR_GETDETACHSTATE_ONE_ARG], [
 AC_CACHE_CHECK(whether pthread_attr_getdetachstate takes one argument, ac_cv_pthread_attr_getdetachstate_one_arg,[
 AC_TRY_COMPILE([
 #include <pthread.h>
@@ -91,7 +91,7 @@
 dnl Try running a program which uses pthreads, executing the
 dnl actions-if-success commands on success.
 dnl
-AC_DEFUN(APR_PTHREADS_TRY_RUN, [
+AC_DEFUN([APR_PTHREADS_TRY_RUN], [
 AC_TRY_RUN( [
 #include <pthread.h>
 #include <stddef.h>
@@ -182,12 +182,12 @@
 dnl the checks for threading support so that they can restored if the
 dnl result is not what the caller wanted.
 dnl
-AC_DEFUN(APR_PTHREADS_CHECK_SAVE, [
+AC_DEFUN([APR_PTHREADS_CHECK_SAVE], [
   apr_pthsv_CFLAGS="$CFLAGS"
   apr_pthsv_LIBS="$LIBS"
 ])dnl
 
-AC_DEFUN(APR_PTHREADS_CHECK_RESTORE, [
+AC_DEFUN([APR_PTHREADS_CHECK_RESTORE], [
   CFLAGS="$apr_pthsv_CFLAGS"
   LIBS="$apr_pthsv_LIBS"
 ])dnl
diff -urN apr-1.4.2/build/gen-build.py apr-1.4.2-haiku/build/gen-build.py
--- apr-1.4.2/build/gen-build.py	2007-02-28 12:44:52.034603008 +0000
+++ apr-1.4.2-haiku/build/gen-build.py	2010-10-13 02:38:51.278659072 +0000
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/bin/env python
 #
 # USAGE: gen-build.py TYPE
 #
diff -urN apr-1.4.2/configure.in apr-1.4.2-haiku/configure.in
--- apr-1.4.2/configure.in	2009-11-16 07:45:28.006291456 +0000
+++ apr-1.4.2-haiku/configure.in	2010-10-13 02:36:44.000000000 +0000
@@ -143,7 +143,7 @@
 AC_PROG_CPP
 AC_PROG_AWK
 AC_PROG_LN_S
-AC_PROG_RANLIB
+AC_PROG_LIBTOOL
 AC_PROG_INSTALL
 AC_CHECK_PROG(RM, rm, rm)
 AC_CHECK_PROG(AS, as, as)
@@ -258,7 +258,7 @@
 dnl otherwise.
 
 case $host in
-    *os390)
+    *os390|*haiku*)
         if test "$ac_test_CFLAGS" != set; then
            APR_REMOVEFROM(CFLAGS,-g)
         fi
@@ -498,6 +498,13 @@
        OSDIR="unix"
        eolstr="\\n"
        ;;
+   *haiku*)
+       OSDIR="unix"
+       eolstr="\\n"
+       AC_CHECK_LIB(bsd, getpass)
+       AC_CHECK_LIB(network, socket)
+       LIBTOOL="libtool"
+       ;;
    *)
        OSDIR="unix"
        eolstr="\\n"
@@ -1099,6 +1106,10 @@
 havemmapzero="0"
 havemmapanon="0"
 APR_BEGIN_DECISION([anonymous shared memory allocation method])
+APR_IFALLYES(header:kernel/OS.h func:create_area,
+             [havebeosshm="1"
+              APR_DECIDE(USE_SHMEM_BEOS_ANON,
+                         [BeOS areas])])
 APR_IFALLYES(header:sys/ipc.h header:sys/shm.h header:sys/file.h dnl
              func:shmget func:shmat func:shmdt func:shmctl,
              [haveshmgetanon="1"
@@ -1170,6 +1181,9 @@
 haveos2shm="0"
 havewin32shm="0"
 APR_BEGIN_DECISION([namebased memory allocation method])
+APR_IFALLYES(header:kernel/OS.h func:create_area,
+             [havebeosshm="1"
+              APR_DECIDE(USE_SHMEM_BEOS, [BeOS areas])])
 APR_IFALLYES(header:sys/mman.h func:mmap func:munmap,
              [havemmaptmp="1"
               APR_DECIDE(USE_SHMEM_MMAP_TMP, 
@@ -1183,9 +1197,6 @@
              func:shmget func:shmat func:shmdt func:shmctl,
              [haveshmget="1"
               APR_DECIDE(USE_SHMEM_SHMGET, [SysV IPC shmget()])])
-APR_IFALLYES(header:kernel/OS.h func:create_area,
-             [havebeosshm="1"
-              APR_DECIDE(USE_SHMEM_BEOS, [BeOS areas])])
 APR_IFALLYES(header:os2.h,
              [haveos2shm="1"
               APR_DECIDE(USE_SHMEM_OS2, [OS/2 DosAllocSharedMem()])])
