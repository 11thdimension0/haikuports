SUMMARY="Apache Portable Runtime Utility Library"
DESCRIPTION="Apache Portable Runtime Utility Library"
HOMEPAGE="http://apr.apache.org/"
SRC_URI="http://archive.apache.org/dist/apr/apr-util-1.3.10.tar.gz"
CHECKSUM_MD5="82acd25cf3df8c72eba44eaee8b80c19"
REVISION="2"
STATUS_HAIKU="stable"

PROVIDES="apr-util = $portVersion compat >= 1
	lib:libaprutil = $portVersion compat >= 1
	lib:libaprutil-1 = $portVersion compat >= 1"
REQUIRES="haiku >= $haikuVersion
	apr >= 1.3.9
	expat >= 2.0"
BUILD_REQUIRES="cmd:aclocal
	cmd:autoconf
	cmd:autoheader
	cmd:gcc
	cmd:ld
	cmd:libtoolize
	cmd:make"
BUILD_PREREQUIRES="haiku-devel >= $haikuVersion"

SOURCE_DIR="$portVersionedName"

# TODO: The hard-coded reference to the apr work directory isn't good at all.
# We should declare a build dependency on the APR sources instead.

BUILD()
{
	aprUtilPackageLinksDir=$(finddir B_PACKAGE_LINKS_DIRECTORY)/$portRevisionedName
	aprInstallDir=$aprUtilPackageLinksDir/apr

	# We need the APR sources to build APR-Util.
	haikuporter -b -y apr-1.4.2
	aprSourceDir=$(haikuporter -t)/dev-libs/apr/work/apr-1.4.2

	rm -rf aclocal.m4
	mkdir -p m4
	haikuporter -b -y apr-1.4.2
	libtoolize -fci
	aclocal --install -I m4
	autoconf -f
	cd xml/expat
	mkdir -p m4
	echo 'AM_INIT_AUTOMAKE' >> configure.in
	libtoolize -fci
	aclocal --install -I m4
	autoconf --force
	autoheader
	touch libtool.m4	
	cd ../..
	sed -i 's/\/usr\/bin\/env/\/bin\/env/' $aprSourceDir/build/gen-build.py
	buildconf --with-apr=`haikuporter -t`/dev-libs/apr/work/apr-1.4.2 \
		--prefix=$prefix
	ln -sf $(which libtool) ./libtool 
    ./configure $configureDirArgs \
		--with-apr=$aprInstallDir/bin/apr-1-config
	make
}

INSTALL()
{
	make install
}

LICENSE="Apache v2"
COPYRIGHT="2010 The Apache Software Foundation."
