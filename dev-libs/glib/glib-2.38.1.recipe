SUMMARY="glib"
DESCRIPTION="glib" 
HOMEPAGE="http://www.gtk.org/" 
SRC_URI="http://ftp.gnome.org/pub/gnome/sources/glib/2.38/glib-2.38.1.tar.xz"
CHECKSUM_MD5="f3f6789151c1810f2fe23fe9ebb8b828"
LICENSE="GNU LGPL v2"
COPYRIGHT="1995-1997  Peter Mattis, Spencer Kimball and Josh MacDonald
	1991-2003 Free Software Foundation, Inc.
	1997-2006 University of Cambridge.
	1998-2001, 2003-2010 Red Hat, Inc.
	2007-2009 Nokia Corporation
	2008, 2010 Oracle and/or its affiliates, Inc. All rights
	2008-2010 Codethink Limited
	2008-2010 Collabora Ltd.
	1995-2010 Several others"

REVISION="1"

ARCHITECTURES="x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86_gcc2 x86 x86_64"

PROVIDES="
	glib$secondaryArchSuffix = $portVersion compat >= 2
	cmd:gdbus
	cmd:gdbus_codegen
	cmd:gio_querymodules
	cmd:glib_compile_resources
	cmd:glib_compile_schemas
	cmd:glib_genmarshal
	cmd:glib_gettextize
	cmd:glib_mkenums
	cmd:gobject_query
	cmd:gresource
	cmd:gsettings
	cmd:gtester
	cmd:gtester_report
	lib:libgio_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	lib:libglib_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	lib:libgmodule_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	lib:libgobject_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	lib:libgthread_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	"

REQUIRES="
	haiku$secondaryArchSuffix >= $haikuVersion
	lib:gettext
	lib:libiconv
	lib:libz
	lib:libffi$secondaryArchSuffix
	lib:gettext
	lib:libintl
	"

BUILD_REQUIRES="
	devel:libiconv
	devel:libz
	devel:libffi$secondaryArchSuffix
	devel:libintl
	"

BUILD_PREREQUIRES="
	haiku${secondaryArchSuffix}_devel >= $haikuVersion
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:libtoolize
	cmd:aclocal
	cmd:autoconf
	cmd:make
	cmd:pkg_config
	cmd:python
	"

PATCH="glib-2.38.1.patch"

PATCH()
{
	sed -i 's/#error No _g_get_unix_mounts() implementation for system/\/* #error No _g_get_unix_mounts() implementation for system *\//' gio/gunixmounts.c
	sed -i 's/#error No g_get_mount_table() implementation for system/\/* #error No g_get_mount_table() implementation for system *\//' gio/gunixmounts.c
}


BUILD()
{
	libtoolize --force --copy --install
	aclocal
	autoconf
	runConfigure ./configure
	make
}

INSTALL()
{
	make install
	
	prepareInstalledDevelLibs libgio-2.0 \
					libglib-2.0 \
					libgmodule-2.0 \
					libgobject-2.0 \
					libgthread-2.0
	fixPkgconfig

	# devel package
	packageEntries devel \
#		$binDir \
		$developDir \
		$manDir/man3
}

# ----- devel package -------------------------------------------------------

PROVIDES_devel="
	glib${secondaryArchSuffix}_devel = $portVersion compat >= 0
	devel:libgio_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	devel:libglib_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	devel:libgmodule_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	devel:libgobject_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	devel:libgthread_2.0$secondaryArchSuffix = 0.3800.1 compat >= 2
	"

REQUIRES_devel="
	glib$secondaryArchSuffix == $portVersion base
	"
