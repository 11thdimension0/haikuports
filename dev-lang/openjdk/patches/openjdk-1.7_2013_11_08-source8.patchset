From e022b9718d7c0c0b72b70c47e736750a890b7623 Mon Sep 17 00:00:00 2001
From: Ingo Weinhold <ingo_weinhold@gmx.de>
Date: Sat, 9 Nov 2013 02:30:27 +0100
Subject: Defs-haiku.gmk: Fix Haiku specific *_PATH variables

* /boot/common has been removed in Haiku.
* USRBIN_PATH is /system/bin.
* UNIXCCS_PATH: The installation directory for binutils/gcc has
  changed.
* DEVTOOLS_PATH: Match the comment. Tools like zip etc. live in
  /system/bin.

diff --git a/make/common/shared/Defs-haiku.gmk b/make/common/shared/Defs-haiku.gmk
index c1cc440..134e128 100644
--- a/make/common/shared/Defs-haiku.gmk
+++ b/make/common/shared/Defs-haiku.gmk
@@ -54,11 +54,10 @@ $(shell if [ "$1" != "" -a -d "$1" ]; then (cd $1 && pwd); else echo "$1"; fi)
 endef
 
 BOOTSYSTEMBIN_PATH = $(shell finddir B_SYSTEM_BIN_DIRECTORY)/
-BOOTCOMMONBIN_PATH = $(shell finddir B_COMMON_BIN_DIRECTORY)/
 BOOTSYSTEMDEVELOP_PATH = $(shell finddir B_SYSTEM_DEVELOP_DIRECTORY)/
 
 # Location on system where jdk installs might be
-USRJDKINSTANCES_PATH =$(BOOTCOMMONBIN_PATH)/java
+USRJDKINSTANCES_PATH =$(BOOTSYSTEMBIN_PATH)/java
 
 # UNIXCOMMAND_PATH: path to where the most common Unix commands are.
 #  NOTE: Must end with / so that it could be empty, allowing PATH usage.
@@ -73,7 +72,7 @@ endif
 ifneq "$(origin ALT_USRBIN_PATH)" "undefined"
   USRBIN_PATH :=$(call PrefixPath,$(ALT_USRBIN_PATH))
 else
-  USRBIN_PATH  = $(BOOTCOMMONBIN_PATH)
+  USRBIN_PATH  = $(BOOTSYSTEMBIN_PATH)
 endif
 
 # UNIXCCS_PATH: path to where the Solaris ported UNIX commands can be found
@@ -81,7 +80,7 @@ endif
 ifneq "$(origin ALT_UNIXCCS_PATH)" "undefined"
   UNIXCCS_PATH :=$(call PrefixPath,$(ALT_UNIXCCS_PATH))
 else
-  UNIXCCS_PATH = $(BOOTSYSTEMDEVELOP_PATH)/tools/gnupro/
+  UNIXCCS_PATH = $(BOOTSYSTEMDEVELOP_PATH)/tools/
 endif
 
 # SLASH_JAVA: location of all network accessable files
@@ -103,7 +102,7 @@ endif
 ifneq "$(origin ALT_COMPILER_PATH)" "undefined"
   COMPILER_PATH :=$(call PrefixPath,$(ALT_COMPILER_PATH))
 else
-  COMPILER_PATH  = $(BOOTSYSTEMDEVELOP_PATH)/tools/gnupro/bin/
+  COMPILER_PATH  = $(BOOTSYSTEMBIN_PATH)
 endif
 
 # OPENWIN_HOME: path to where the X11 environment is installed.
@@ -119,7 +118,7 @@ endif
 ifneq "$(origin ALT_DEVTOOLS_PATH)" "undefined"
   DEVTOOLS_PATH :=$(call PrefixPath,$(ALT_DEVTOOLS_PATH))
 else
-  DEVTOOLS_PATH =$(BOOTSYSTEMDEVELOP_PATH)/tools/gnupro/bin/
+  DEVTOOLS_PATH =$(BOOTSYSTEMBIN_PATH)
 endif
 
 # _BOOTDIR1: First choice for a Bootstrap JDK, previous released JDK.
-- 
1.8.3.4


From 6b685d7575c8263ddc856d9a3f9c6c9d8e3078c1 Mon Sep 17 00:00:00 2001
From: Ingo Weinhold <ingo_weinhold@gmx.de>
Date: Sat, 9 Nov 2013 02:35:20 +0100
Subject: PLATFORM_API_HaikuOS_PCM.cpp: Fix SoundConsumer include

It's a private system header, so specify its path explicitly.

diff --git a/src/solaris/native/com/sun/media/sound/PLATFORM_API_HaikuOS_PCM.cpp b/src/solaris/native/com/sun/media/sound/PLATFORM_API_HaikuOS_PCM.cpp
index ec111fc..d69c6a9 100644
--- a/src/solaris/native/com/sun/media/sound/PLATFORM_API_HaikuOS_PCM.cpp
+++ b/src/solaris/native/com/sun/media/sound/PLATFORM_API_HaikuOS_PCM.cpp
@@ -35,7 +35,7 @@ extern "C" {
 #include <MediaDefs.h>
 #include <MediaNode.h>
 #include <MediaRoster.h>
-#include <SoundConsumer.h>
+#include <private/media/SoundConsumer.h>
 #include <SoundPlayer.h>
 #include <TimeSource.h>
 
-- 
1.8.3.4


From fd80deb96af7c068b2ceca47fea7e45b13307ecc Mon Sep 17 00:00:00 2001
From: Ingo Weinhold <ingo_weinhold@gmx.de>
Date: Sat, 9 Nov 2013 14:52:36 +0100
Subject: Fix freetype paths for Haiku


diff --git a/make/common/Defs.gmk b/make/common/Defs.gmk
index a478f97..c0dc0d0 100644
--- a/make/common/Defs.gmk
+++ b/make/common/Defs.gmk
@@ -170,8 +170,8 @@ ifeq ($(PLATFORM), solaris)
   DEVTOOLS_FT_DIR=$(JDK_DEVTOOLS_DIR)/$(ARCH_FAMILY)/freetype-$(ARCH)
 endif
 ifeq ($(PLATFORM), haiku)
-  ALT_FREETYPE_HEADERS_PATH=$(shell finddir B_SYSTEM_HEADERS_DIRECTORY)/3rdparty/freetype2
-  ALT_FREETYPE_LIB_PATH=$(shell finddir B_SYSTEM_LIB_DIRECTORY)/gcc4
+  ALT_FREETYPE_HEADERS_PATH=$(shell finddir B_SYSTEM_HEADERS_DIRECTORY)
+  ALT_FREETYPE_LIB_PATH=$(shell finddir B_SYSTEM_DEVELOP_DIRECTORY)/lib
 endif
 
 DEVTOOLS_FT_DIR_EXISTS = $(shell \
-- 
1.8.3.4


From e70bf2516ea1f3e533e3428ed7c3b3b5b32f1917 Mon Sep 17 00:00:00 2001
From: Ingo Weinhold <ingo_weinhold@gmx.de>
Date: Sat, 9 Nov 2013 14:53:56 +0100
Subject: HaikuFontManager: Use BPathFinder API to find font dirs


diff --git a/src/solaris/native/sun/hawt/HaikuFontManager.cpp b/src/solaris/native/sun/hawt/HaikuFontManager.cpp
index a645d00..66af9ab 100644
--- a/src/solaris/native/sun/hawt/HaikuFontManager.cpp
+++ b/src/solaris/native/sun/hawt/HaikuFontManager.cpp
@@ -25,9 +25,8 @@
 
 #include <jni.h>
 
-#include <FindDirectory.h>
-#include <Path.h>
-#include <String.h>
+#include <PathFinder.h>
+#include <StringList.h>
 
 extern "C" {
 
@@ -40,19 +39,9 @@ JNIEXPORT jstring JNICALL
 Java_sun_hawt_HaikuFontManager_nativeGetFontPath
   (JNIEnv *env, jobject thiz)
 {
-	BPath systemFontsDirectory;
-	BPath commonFontsDirectory;
-	BPath userFontsDirectory;
-	
-	find_directory(B_SYSTEM_FONTS_DIRECTORY, &systemFontsDirectory);
-	find_directory(B_COMMON_FONTS_DIRECTORY, &commonFontsDirectory);
-	find_directory(B_USER_FONTS_DIRECTORY, &userFontsDirectory);
-	
-	BString path;
-	path << systemFontsDirectory.Path() << "/ttfonts:"
-		<< commonFontsDirectory.Path() << "/ttfonts:"
-		<< userFontsDirectory.Path() << "/ttfonts";
-	return env->NewStringUTF(path.String());
+	BStringList paths;
+	BPathFinder().FindPaths(B_FIND_PATH_FONTS_DIRECTORY, "ttfonts", paths);
+	return env->NewStringUTF(paths.Join(":").String());
 }
 
 }
-- 
1.8.3.4

