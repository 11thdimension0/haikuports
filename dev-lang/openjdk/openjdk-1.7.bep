DESCRIPTION="openjdk" 
HOMEPAGE="http://openjdk.java.net" 
SRC_URI="http://ports-space.haiku-files.org/dev-lang/j2sdk-july-r2.tar.xz"
REVISION="1"
STATUS_HAIKU="broken"
DEPEND="app-arch/cpio >= 2.10
	media-libs/freetype >= 2.4.6"
MESSAGE="This port only builds with gcc4. Use 'setgcc gcc4' before building."
CHECKSUM_MD5="28b8630373769e1e897a75bf81f2e1eb"

BUILD {
	OPENJDK_DIR=`haikuporter -t`/dev-lang/openjdk/work/openjdk-1.7
	mkdir -p openjdk-1.7
	cd openjdk-1.7
	cp -r ../j2sdk-image ${OPENJDK_DIR}/j2sdk-image
	  
	# get and build ant
	wget http://archive.apache.org/dist/ant/source/apache-ant-1.8.4-src.tar.gz
	tar xvfz apache-ant-1.8.4-src.tar.gz
	export LIBRARY_PATH=${OPENJDK_DIR}/j2sdk-image/jre/lib/i386/:$LIBRARY_PATH
	export JAVA_HOME=${OPENJDK_DIR}/j2sdk-image
	export ANT_HOME=${OPENJDK_DIR}/ant
	cd apache-ant-1.8.4
	sed -i 's/depends=\"jars,test-jar\"/depends=\"jars\"/' build.xml
	sh build.sh install-lite
	unset JAVA_HOME
	cd ..

	hg clone https://bitbucket.org/hamishm/haiku-jdk jdk
	hg clone https://bitbucket.org/hamishm/haiku-jdk-langtools jdk/langtools
	hg clone https://bitbucket.org/hamishm/haiku-jdk-hotspot jdk/hotspot
	hg clone https://bitbucket.org/hamishm/haiku-jdk-jaxp jdk/jaxp
	hg clone https://bitbucket.org/hamishm/haiku-jdk-jaxws jdk/jaxws
	hg clone https://bitbucket.org/hamishm/haiku-jdk-corba jdk/corba
	hg clone https://bitbucket.org/hamishm/haiku-jdk-jdk jdk/jdk
	
	export ALT_BOOTDIR=${OPENJDK_DIR}/j2sdk-image
	export ALT_JDK_IMPORT_PATH=${OPENJDK_DIR}/j2sdk-image'
	export ANT=${OPENJDK_DIR}/ant'
	mkdir -p ${OPENJDK_DIR}/output
	export ALT_OUTPUTDIR=${OPENJDK_DIR}/output'
	export ALLOW_DOWNLOADS='true'
	make
}

INSTALL {
	cd openjdk-1.7
	make install
}

TEST {
	cd openjdk-1.7
#	make test
#	make check
}

#LICENSE=""
#COPYRIGHT=""
