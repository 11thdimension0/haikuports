From abfee17ebd2a3cf37fc5d488a8226887bbaa514e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Revol?= <revol@free.fr>
Date: Wed, 11 Dec 2013 10:16:33 +0100
Subject: [PATCH 1/3] Add Haiku resource definition file

Icon designed by me, extracted from:
data/artwork/icons/App_OpenCubicPlayer from Haiku sources
---
 ocp.rdef | 39 +++++++++++++++++++++++++++++++++++++++
 1 file changed, 39 insertions(+)
 create mode 100644 ocp.rdef

diff --git a/ocp.rdef b/ocp.rdef
new file mode 100644
index 0000000..c710155
--- /dev/null
+++ b/ocp.rdef
@@ -0,0 +1,39 @@
+/* Haiku resources definitions for OCP */
+
+resource app_signature "application/x-vnd.OpenCubicPlayer";
+
+resource app_version {
+	major  = 0,
+	middle = 1,
+	minor  = 21,
+
+	variety = B_APPV_BETA,
+
+	internal = 0,
+
+	short_info = "Open Cubic Player",
+	long_info = "Open Cubic Player Â©1994-2012 Niklas Beisert, Stian Skjelstad and others."
+};
+
+resource app_flags B_MULTIPLE_LAUNCH | B_ARGV_ONLY;
+
+resource file_types message {
+	"types" = "application/ogg",
+	"types" = "application/x-ogg",
+	"types" = "audio"
+};
+
+resource("BEOS:ICON") #'VICN' array {
+	$"6E636966060500020006023B55F13C5CD2BE755C3D78974A454E48FFCB006464"
+	$"CEFF1C184C020016023CD471BA2F923B0FF33DF6F048DA184417BB00FFFFBB02"
+	$"0016023C318B3A487CBD09B43EEB2D4B485C48176F0099FF4A04016D04FF6D07"
+	$"0A0627312C483D58594A582F43220A0427312C483D5838400A0427313840582F"
+	$"43220A043D58594A582F38400A042C5039605F59483D0204422840284428452A"
+	$"4528452C422C442C402C3F2A3F2C3F280A032351235C2B57160A040104000A00"
+	$"01001001178400040A010101000A020102000A030103000A05010528211E10FF"
+	$"0A04010528211F10FF0A05010528292510FF0A04010528292610FF0A05010528"
+	$"112610FF0A04010528112710FF0A050105281A2D10FF0A040105281A2E10FF0A"
+	$"050105281F3A10FF0A040105281E3A10FF0A050105282E3210FF0A040105282D"
+	$"3210FF0A05010528224310FF0A04010528214310FF0A05010528303C10FF0A04"
+	$"0105282F3C10FF0A0001060810FF"
+};
-- 
1.8.3.4


From 00d262017380ec6310981445124271f39d29adbc Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Revol?= <revol@free.fr>
Date: Wed, 11 Dec 2013 10:17:36 +0100
Subject: [PATCH 2/3] Export HAIKU variable to indicate building on Haiku

---
 Rules.make.in | 1 +
 configure.ac  | 2 ++
 2 files changed, 3 insertions(+)

diff --git a/Rules.make.in b/Rules.make.in
index 636f0ba..f1f7e98 100644
--- a/Rules.make.in
+++ b/Rules.make.in
@@ -6,6 +6,7 @@ INFODIR=@INFODIR@
 BINDIR=@BINDIR@
 SYSCONFDIR=@SYSCONFDIR@
 DESKTOP_FILE_INSTALL=@DESKTOP_FILE_INSTALL@
+HAIKU=@HAIKU@
 
 DIR_SUFFIX=@DIR_SUFFIX@
 
diff --git a/configure.ac b/configure.ac
index e6ecfb1..1efdc26 100644
--- a/configure.ac
+++ b/configure.ac
@@ -31,6 +31,7 @@ AC_C_BIGENDIAN
 AC_SUBST(SHARED_FLAGS)
 AC_SUBST(LIB_SUFFIX)
 AC_SUBST(PTHREAD_LIBS)
+AC_SUBST(HAIKU)
 target=`gcc -dumpmachine`
 case "$target" in
 	*-darwin*)
@@ -45,6 +46,7 @@ case "$target" in
 		LIB_SUFFIX=.so
 		PTHREAD_LIBS=
 		with_desktop_file_install=no
+		HAIKU=1
 		;;
 	*)
 		SHARED_FLAGS=-shared
-- 
1.8.3.4


From 06a80659002069af814b8b062fd5d2b4cd8b27ce Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Revol?= <revol@free.fr>
Date: Wed, 11 Dec 2013 10:18:30 +0100
Subject: [PATCH 3/3] Apply resources file when building on Haiku

---
 Makefile.in | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/Makefile.in b/Makefile.in
index f3a1c13..aa21c6d 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -166,6 +166,11 @@ endif
 
 ocp: boot/kickload.o
 	$(CC) $(LDFLAGS) -o $@ $^ @DL_LIBS@ @EFENCE_LIBS@ @DUMA_LIBS@
+ifeq ($(HAIKU),1)
+	rc -o ocp.rsrc ocp.rdef
+	xres -o $@ ocp.rsrc
+	mimeset $@
+endif
 
 ocp.hlp: doc/opencp.dox goodies/helpc/ocphhc
 	goodies/helpc/ocphhc doc/opencp.dox $@
@@ -202,6 +207,7 @@ endif
 	find . -name '*~' -exec rm {} ';'
 	rm -f ocp.hlp ocp *$(LIB_SUFFIX)
 	rm -f CPARCH.DAT
+	rm -f ocp.rsrc
 
 distclean: clean
 	rm -Rf config.h autom4te.cache Rules.make config.log config.status Makefile ocp.ini desktop/opencubicplayer.desktop doc/texi/faq.texi doc/texi/install.texi doc/texi/ocp.texi goodies/pack/Makefile goodies/helpc/Makefile Makefile
-- 
1.8.3.4

