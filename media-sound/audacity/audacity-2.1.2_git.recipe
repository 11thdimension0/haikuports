SUMMARY="Audio software for multi-track recording and editing"
DESCRIPTION="Audacity can be used to perform a number of audio editing and \
recording tasks such as making ringtones, mixing stero tracks, transferring \
tapes and records to computer or CD, splitting recordings into separate \
tracks and more."
HOMEPAGE="http://www.audacityteam.org"
COPYRIGHT="1999-2017 by Audacity Team"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/audacity/audacity/archive/0ceae629648d900dc11967328ad32630f7f3f99f.tar.gz"
CHECKSUM_SHA256="e9eb1ad8c0a2b81dbb943f52ebe908549480108916f49ce0d6e9eb5997726349"
SOURCE_DIR="audacity-0ceae629648d900dc11967328ad32630f7f3f99f"
#PATCHES="cantata-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 ?x86 ?x86_64"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	audacity$secondaryArchSuffix = $portVersion
	app:Audacity$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	wxqt$secondaryArchSuffix
	lib:libintl$secondaryArchSuffix
	lib:libiconv$secondaryArchSuffix
	lib:libsndfile$secondaryArchSuffix
#	lib:libid3tag$secondaryArchSuffix		-- missing pkgconfig
#	lib:libmad$secondaryArchSuffix			-- missing pkgconfig
#	lib:libflac$secondaryArchSuffix			-- configure finds it but refuses to use???
	lib:libexpat$secondaryArchSuffix
#	lib:libavcodec$secondaryArchSuffix		-- configure finds it but refuses to use???
#	lib:libavformat$secondaryArchSuffix		-- configure finds it but refuses to use???
#	lib:libavutil$secondaryArchSuffix		-- configure finds it but refuses to use???
	lib:libz$secondaryArchSuffix			#-- only because of intree flac
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	wxqt${secondaryArchSuffix}_devel
	devel:libintl$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
	devel:libsndfile$secondaryArchSuffix
#	devel:libid3tag$secondaryArchSuffix
#	devel:libmad$secondaryArchSuffix
#	devel:libflac$secondaryArchSuffix
	devel:libexpat$secondaryArchSuffix
	devel:libavcodec$secondaryArchSuffix
	devel:libavformat$secondaryArchSuffix
	devel:libavutil$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:pkg_config$secondaryArchSuffix
	cmd:wx_config$secondaryArchSuffix
	cmd:awk
	cmd:diff
	cmd:gettext$secondaryArchSuffix
	cmd:which
	cmd:make
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	"

PATCH()
{
	# Hack in support for wxWidgets 3.1.
	sed -i 's/3.0.\*)/3.1.\*)/g' configure

	# The lv2 configure script is a broken pile of garbage.
	rm -rf lib-src/lv2/
}

BUILD()
{
	# Audacity's configure script is very broken, it won't use system
	# stuff even if you tell it to. Go figure.
	runConfigure ./configure --disable-dynamic-loading --without-libmad
	make $jobArgs
}

INSTALL()
{
	make install
}
