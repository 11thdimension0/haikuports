SUMMARY="CD (Canvas Draw) is a platform-independent graphics library."
HOMEPAGE="http://www.tecgraf.puc-rio.br/cd/"
SRC_URI="http://heanet.dl.sourceforge.net/project/canvasdraw/5.6.1/Docs%20and%20Sources/cd-5.6.1_Sources.zip"
	# They have a tar.gz but the permissions are broken inside it (will create unreadable files)
CHECKSUM_MD5="0953b2d9a094a14608f73561038ad84d"
REVISION="1"
ARCHITECTURES="x86_gcc2"
PROVIDES="
	cd$secondaryArchSuffix = $portVersion
	lib:libcd = $portVersion
	lib:libcdgl = $portVersion
	lib:libcdlua51 = $portVersion
	lib:libcdlua52 = $portVersion
	lib:libcdluagl51 = $portVersion
	lib:libcdluagl52 = $portVersion
	lib:libcdluaim51 = $portVersion
	lib:libcdluaim52 = $portVersion
	lib:libcdluapdf51 = $portVersion
	lib:libcdluapdf52 = $portVersion
	lib:libcdpdf = $portVersion

	lib:libftgl = $portVersion
	lib:libpdflib = $portVersion
	"
REQUIRES="
	haiku >= $haikuVersion
	lib:libGLU
	lib:libz
	lib:libfreetype
"

BUILD_REQUIRES="
	haiku_devel$secondaryArchSuffix >= $haikuVersion
	cmd:make
	cmd:gcc$secondaryArchSuffix
	cmd:which
	devel:libfontconfig
	devel:libfreetype
	devel:libglu
	devel:libiconv
	devel:libim
	devel:liblua
	devel:libz
"

SOURCE_DIR="cd"
PATCHES="cd-5.6.patchset"
BUILD()
{
	cd src
	make
}

INSTALL()
{
	mkdir -p $developLibDir
	mkdir -p $libDir
	mkdir -p $includeDir

	# These are built as dependencies instead of using the system ones...
	rm lib/Haiku11/libz.*
	rm lib/Haiku11/libfreetype.*

	cp lib/Haiku11/*.so $libDir
	cp lib/Haiku11/*.a $developLibDir
	cp include/* $includeDir

	# Won't work, the libs have no soname...
#	prepareInstalledDevelLib libim
#		libim libim_fftw libim_jp2 libim_process libim_process_omp \
#		libimlua51 libimlua_fftw51 libimlua_jp251 libimlua_process51 libimlua_process_omp51 \
#		libimlua52 libimlua_fftw52 libimlua_jp252 libimlua_process52 libimlua_process_omp52
		
	packageEntries devel $developDir
}

PROVIDES_devel="
	cd${secondaryArchSuffix}_devel = $portVersion
	devel:libcd = $portVersion
	devel:libcdgl = $portVersion
	devel:libcdlua51 = $portVersion
	devel:libcdlua52 = $portVersion
	devel:libcdluagl51 = $portVersion
	devel:libcdluagl52 = $portVersion
	devel:libcdluaim51 = $portVersion
	devel:libcdluaim52 = $portVersion
	devel:libcdluapdf51 = $portVersion
	devel:libcdluapdf52 = $portVersion
	devel:libcdpdf = $portVersion

	devel:libftgl = $portVersion
	devel:libpdflib = $portVersion
"

LICENSE="MIT"
COPYRIGHT="1994-2013 Tecgraf, PUC-Rio."
DESCRIPTION="CD (Canvas Draw) is a platform-independent graphics library. It is implemented in several platforms using native graphics libraries: Microsoft Windows (GDI) and X-Windows (XLIB).

The library contains functions to support both vector and image applications, and the visualization surface can be either a window or a more abstract surface, such as Image, Clipboard, Metafile, PS, and so on.
"
